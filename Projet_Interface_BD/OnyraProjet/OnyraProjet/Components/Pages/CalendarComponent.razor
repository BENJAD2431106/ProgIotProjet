@using System.Globalization
<h3>@CurrentMonth.ToString("MMMM yyyy", CultureInfo.GetCultureInfo("fr-FR"))</h3>

<div class="d-flex justify-content-between align-items-center mb-2">
    <button class="btn btn-outline-primary btn-sm" @onclick="() => OnPrevMonth.InvokeAsync()">◀️</button>
    <strong>@CurrentMonth.ToString("MMMM yyyy", CultureInfo.GetCultureInfo("fr-FR"))</strong>
    <button class="btn btn-outline-primary btn-sm" @onclick="() => OnNextMonth.InvokeAsync()">▶️</button>
</div>

@if (Days != null && Days.Any())
{
    <table class="table table-bordered text-center">
        <thead class="table-light">
            <tr>
                @foreach (var dayName in DayNames)
                {
                    <th>@dayName</th>
                }
            </tr>
        </thead>
        <tbody>
            @for (int week = 0; week < 6; week++)
            {
                <tr>
                    @for (int day = 0; day < 7; day++)
                    {
                        var index = week * 7 + day;
                        var date = Days[index];
                        var isCurrentMonth = date.Month == CurrentMonth.Month;
                        var isSelected = date == SelectedDate;
                        var isFilled = JoursRemplis.Contains(DateOnly.FromDateTime(date));

                        string baseStyle = GetCellStyle(isCurrentMonth, isSelected, isFilled);

                        <td style="@baseStyle" class="p-3" @onclick="() => OnDaySelected.InvokeAsync(date)">
                            @date.Day
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
}

@code {
    [Parameter] public DateTime CurrentMonth { get; set; }
    [Parameter] public List<DateTime> Days { get; set; } = new();
    [Parameter] public string[] DayNames { get; set; } = Array.Empty<string>();
    [Parameter] public DateTime SelectedDate { get; set; }
    [Parameter] public List<DateOnly> JoursRemplis { get; set; } = new();

    // Événements (pour remonter l'action au parent)
    [Parameter] public EventCallback OnPrevMonth { get; set; }
    [Parameter] public EventCallback OnNextMonth { get; set; }
    [Parameter] public EventCallback<DateTime> OnDaySelected { get; set; }

    private string GetCellStyle(bool isCurrentMonth, bool isSelected, bool isFilled)
    {
        string baseStyle = "padding:6px; text-align:center; border:1px solid #ccc; cursor:pointer;";
        if (!isCurrentMonth)
            baseStyle += "color:gray;";
        if (isSelected)
            baseStyle += "background-color:lightblue; font-weight:bold;";
        if (isFilled)
            baseStyle += "background-color:grey; color:white; font-weight:bold;";

        // Surcharge si à la fois sélectionné et rempli
        if (isSelected && isFilled)
            baseStyle += "background-color:#5a6268; color:yellow;"; // couleur pour le jour sélectionné et rempli

        return baseStyle;
    }
}